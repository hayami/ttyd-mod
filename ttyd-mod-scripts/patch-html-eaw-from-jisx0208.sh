#!/bin/sh
set -e
src="$1"

# East Asian Width が Ambiguous と定義されている JIS X 0208 由来の文字
# (但し CYRILLIC, GREEK 文字を除く)
aw_range_list='[167,168]
[176,177]
[180,180]
[182,182]
[215,215]
[247,247]
[8208,8208]
[8213,8213]
[8216,8217]
[8220,8221]
[8224,8225]
[8229,8230]
[8240,8240]
[8242,8243]
[8251,8251]
[8451,8451]
[8491,8491]
[8592,8595]
[8658,8658]
[8660,8660]
[8704,8704]
[8706,8707]
[8711,8712]
[8715,8715]
[8730,8730]
[8733,8734]
[8736,8736]
[8741,8741]
[8743,8748]
[8756,8757]
[8765,8765]
[8786,8786]
[8800,8801]
[8806,8807]
[8810,8811]
[8834,8835]
[8838,8839]
[8869,8869]
[8978,8978]
[9472,9475]
[9484,9484]
[9487,9488]
[9491,9492]
[9495,9496]
[9499,9501]
[9504,9504]
[9507,9509]
[9512,9512]
[9515,9516]
[9519,9520]
[9523,9524]
[9527,9528]
[9531,9532]
[9535,9535]
[9538,9538]
[9547,9547]
[9632,9633]
[9650,9651]
[9660,9661]
[9670,9671]
[9675,9675]
[9678,9679]
[9711,9711]
[9733,9734]
[9792,9792]
[9794,9794]
[9834,9834]
[9837,9837]
[9839,9839]'
aw_range_str=$(printf '%s' "$aw_range_list" | tr '\n' ',')
#echo "aw_range_str={$aw_range_str}"


# see BMP_WIDE = [...]; in node_modules/@xterm/addon-unicode11/src/UnicodeV11.ts
orig_pre=',[65504,65510]'
orig_post=']'

orig="${orig_pre}${orig_post}"
new="${orig_pre},${aw_range_str}${orig_post}"
file="$src/html/node_modules/@xterm/addon-unicode11/lib/addon-unicode11.js"

ret=0
ttyd-mod-scripts/fsed "$orig" "$new" "$file" || ret=$?
exit $ret
